{% comment %} Simple fallback that loads as much as possible in one go {% endcomment %}

<link rel="stylesheet" href="//cdn.datatables.net/2.3.4/css/dataTables.dataTables.min.css">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<section class="py-12">
  <div class="container mx-auto px-4">

    <div class="text-center">
      {{ page.content }}
    </div>

    <div class="store-locator_footer mt-8 mb-4">
      <h2>Redeeming your gift certificate at a grocery store near you.</h2>
      <p>Your Certificate is good for any brand selection, as well as for any variety of product that fits the certificate description.</p>
      <p>Examples: Whole or partial Turkey, whole or partial Ham, Fresh, Frozen, or even Canned and Prepackaged items are all fine. Select items that fit the description on your certificate and take them to the checkout stand and present your Gift Certificate like a coupon to the cashier. It's that simple!</p>
    </div>
  </div>
</section>

<section id="store-locator" class="pb-12">
  <div class="container mx-auto">

    <div class="flex flex-wrap gap-4 items-center">
      <div class="flex flex-col">
        <label for="state-filter" class="text-sm font-medium text-gray-700 mb-1">Filter by State:</label>
        <select id="state-filter" class="js-states w-48 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
          <option value="">All States</option>
          <optgroup label="Alaskan/Hawaiian Time Zone">
            <option value="AK">Alaska</option>
            <option value="HI">Hawaii</option>
          </optgroup>
          <optgroup label="Pacific Time Zone">
            <option value="CA">California</option>
            <option value="NV">Nevada</option>
            <option value="OR">Oregon</option>
            <option value="WA">Washington</option>
          </optgroup>
          <optgroup label="Mountain Time Zone">
            <option value="AZ">Arizona</option>
            <option value="CO">Colorado</option>
            <option value="ID">Idaho</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NM">New Mexico</option>
            <option value="ND">North Dakota</option>
            <option value="UT">Utah</option>
            <option value="WY">Wyoming</option>
          </optgroup>
          <optgroup label="Central Time Zone">
            <option value="AL">Alabama</option>
            <option value="AR">Arkansas</option>
            <option value="IL">Illinois</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="OK">Oklahoma</option>
            <option value="SD">South Dakota</option>
            <option value="TX">Texas</option>
            <option value="TN">Tennessee</option>
            <option value="WI">Wisconsin</option>
          </optgroup>
          <optgroup label="Eastern Time Zone">
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="IN">Indiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="OH">Ohio</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WV">West Virginia</option>
          </optgroup>
        </select>
      </div>

      <div class="flex flex-col">
        <label class="text-sm font-medium text-gray-700 mb-1">&nbsp;</label>
        <button id="clear-filters" class="btn btn--primary !py-2">
          Clear Filters
        </button>
      </div>

      <!-- Info Display -->
      <div id="data-info" class="flex flex-col">
        <span class="text-sm font-medium text-gray-700">Store Count:</span>
        <span class="text-lg font-semibold text-brandPrimary">Loading...</span>
      </div>

    </div>

    <div class="bg-white rounded-lg shadow-sm border overflow-hidden mt-6">
      <table id="stores-table" class="w-full">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">State</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Store Name</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <!-- Data will be populated by DataTables -->
        </tbody>
      </table>
    </div>
  </div>
</section>
{%- assign entry_list = metaobjects.store_data_json.values -%}
<script type="application/json" id="store-locator-data">
  {{ entry_list | json }}
</script>
<style>
  /* Custom DataTables styling */
  .dataTables_wrapper {
    font-family: inherit;
  }

  .dataTables_filter,
  .dataTables_length {
    margin-bottom: 0;
  }

  #stores-table_wrapper .dataTables_paginate {
    margin-top: 1rem;
  }

  /* Remove default DataTables styling that conflicts with Tailwind */
  table.dataTable thead th {
    border-bottom: none;
  }

  table.dataTable.no-footer {
    border-bottom: none;
  }

  .dataTables_wrapper .dataTables_filter input {
    border-radius: 0.375rem;
  }
</style>